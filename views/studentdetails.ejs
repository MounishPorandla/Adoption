<%- include("header") -%>
<link rel="stylesheet" href="css/studentdetails.css">


<script type="text/javascript">
  function reveal() {
    var reveals = document.querySelectorAll(".reveal");

    for (var i = 0; i < reveals.length; i++) {
      var windowHeight = window.innerHeight;
      var elementTop = reveals[i].getBoundingClientRect().top;
      var elementVisible = 150;

      if (elementTop < windowHeight - elementVisible) {
        reveals[i].classList.add("active");
      } else {
        reveals[i].classList.remove("active");
      }
    }
  }

  window.addEventListener("scroll", reveal);


  $(function() {
    $('.repeat').click(function() {
      var classes = $(this).parent().attr('class');
      $(this).parent().attr('class', 'animate');
      var indicator = $(this);
      setTimeout(function() {
        $(indicator).parent().addClass(classes);
      }, 20);
    });
  });

  function openForm() {
    document.getElementById("myForm").style.display = "block";
    console.log("clicked");
  }

  function closeForm() {
    document.getElementById("myForm").style.display = "none";
    console.log("clicked");
  }

  function openForm2() {
    document.querySelector('.bg-modal').style.display = "flex";
    console.log("clicked");
  }

  function closeForm2() {
    document.querySelector('.bg-modal').style.display = "none";
    console.log("* clicked");
  }


  document.getElementById('button').addEventListener("click", function() {
    document.querySelector('.bg-modal').style.display = "flex";
    console.log("clicked");
  });

  document.querySelector('.close').addEventListener("click", function() {
    document.querySelector('.bg-modal').style.display = "none";
    console.log("* clicked");
  });
</script>

</head>

<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-ligh">
    <a class="navbar-brand" href="/" style="border:0">Orphanage</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <a class="btn btn-light logout  navbarbutton" href="/logout" role="button">Log Out</a>
    <div class="collapse navbar-collapse mr-right" id="navbarSupportedContent">
    </div>
  </nav>


  <%const array=[ ]%>
  <%const groupname=" "%>
  <%chat.forEach(function(chatitem){ %>
  <%items.forEach(function(item){ %>
  <%if(item.adminname=== check){ %>
  <%founduser.forEach(function(useritem){ %>
  <%if(array.includes(chatitem.sendername) === false && chatitem.sendername===useritem.name && item.name==chatitem.recevername){ %>
  <%array.push(chatitem.sendername)%>
  <%} %>
  <%}) %>
  <%} %>
  <%}) %>
  <%}) %>



  <button class="open-button" onclick="openForm()">Chat</button>
  <div class="chat-popup" id="myForm">
    <%items.forEach(function(orphanitem){ %>
    <%if(orphanitem.adminname=== check){ %>
    <div class="chatboxheading">
      <h5> Chat With </h5>
    </div>
    <% array.forEach(function(item){ %>
    <div class="chat">
      <h4 class="listItem"><%=item%></h4>
      <a class="chatatag" href="/chat/with/<%=item%>+<%=orphanitem.name%>">Chat</a>
    </div>
    <%}) %>
    <%} %>
    <%}) %>
    <form action="/action_page.php" class="form-container">
      <button type="button" class="btn cancel" onclick="closeForm()">Close</button>
    </form>
  </div>




  <!-- ////////////////////////////////////////////////////////////////////// -->
  <%items.forEach(function(item){ %>
  <%if(check===item.adminname){%>
  <h3 class="name animate__animated animate__rubberBand"> <%=item.name%></h3>
  <%}%>
  <%}) %>
  <!-- ////////////////////////////////pop out////////////////////////////////////// -->
  <%items.forEach(function(item){ %>
  <%if(check===item.adminname){%>
  <div class="bg-modal">
    <div class="modal-contents">
      <button class="close" onclick="closeForm2()"><span class="iconify" data-icon="ant-design:close-outlined" style="color: black; font-size: 20px;"></span></button>
      <h3>Upadate Your Details</h3>
      <form action="/orphanagedetailsupdatename" method="POST" enctype="multipart/form-data">
        <div class="input-group mb-3">
          <input type="text" id="Orphanagename" class="form-control" name="Orphanagename" placeholder="Orphanagename " autocomplete="off" aria-label=" Recipient's username" aria-describedby="basic-addon2">
          <div class="input-group-append">
            <button class="btn btn-outline-secondary" type="submit" value="<%=item._id%>+<%=item.name%>" name="button">Update Name</button>
          </div>
        </div>
      </form>
      <form action="/orphanagedetailsupdatephonenumber" method="POST" enctype="multipart/form-data">
        <div class="input-group mb-3">
          <input type="text" id="phonenumber" name="phonenumber" class="input form-control" placeholder=" phonenumber" aria-label=" Recipient's username" aria-describedby="basic-addon2">
          <div class="input-group-append">
            <button class="btn btn-outline-secondary" type="submit" value="<%=item._id%>" name="button">Update Phonenumber</button>
          </div>
        </div>
      </form>
      <form action="/orphanagedetailsupdateemail" method="POST" enctype="multipart/form-data">
        <div class="input-group mb-3">
          <input id="Email" type="email" name="email" class="input form-control" placeholder=" email" aria-label=" Recipient's username" aria-describedby="basic-addon2">
          <div class="input-group-append">
            <button class="btn btn-outline-secondary" type="submit" value="<%=item._id%>" name="button">Update Email</button>
          </div>
        </div>
      </form>
      <form action="/orphanagedetailsupdateAddress" method="POST" enctype="multipart/form-data">
        <div class="input-group mb-3">
          <input id="Address" type="text" class="input form-control" name="Address" placeholder="Address" aria-label=" Recipient's username" aria-describedby="basic-addon2">
          <div class="input-group-append">
            <button class="btn btn-outline-secondary" type="submit" value="<%=item._id%>" name="button">Update Address</button>
          </div>
        </div>
      </form>
      <form action="/orphanagedetailsupdatecity" method="POST" enctype="multipart/form-data">
        <div class="input-group mb-3">
          <input id="City" type="text" class="input form-control" name="city" placeholder="city" aria-label= "Recipient's username" aria-describedby="basic-addon2">
          <div class="input-group-append">
            <button class="btn btn-outline-secondary" type="submit" value="<%=item._id%>" name="button">Upadate City"</button>
          </div>
        </div>
      </form>
      <form action="/orphanagedetailsupdatestate" method="POST" enctype="multipart/form-data">
        <div class="input-group mb-3">
          <select id="State" name="state" class="state input form-control" placeholder=" " aria-label=" Recipient's username" aria-describedby="basic-addon2" />
          <option selected>State</option>
          <option>Andhra pradesh</option>
          <option>Arunachal pradesh</option>
          <option>Assam</option>
          <option>bihar</option>
          <option>chattisgarh</option>
          <option>goa</option>
          <option>gujarat</option>
          <option>haryana</option>
          <option>himachal pradesh</option>
          <option>jharkhand</option>
          <option>karnataka</option>
          <option>kerala</option>
          <option>madhya pradesh</option>
          <option>maharastra</option>
          <option>manipur</option>
          <option>meghalaya</option>
          <option>mizoram</option>
          <option>nagaland</option>
          <option>odisa</option>
          <option>punjab</option>
          <option>rajasthan</option>
          <option>sikkim</option>
          <option>tamilnadu</option>
          <option>telangana</option>
          <option>tripura</option>
          <option>uttarakhand</option>
          <option>uttar pradesh</option>
          <option>west bengal</option>
          </select>
          <div class="input-group-append">
            <button class="btn btn-outline-secondary" type="submit" value="<%=item._id%>" name="button">Upadate State"</button>
          </div>
        </div>
      </form>
      <form action="/orphanagedetailsupdatepincode" method="POST" enctype="multipart/form-data">
        <div class="input-group mb-3">
          <input id="pincode" type="text" name="pincode" class="input form-control" placeholder="pincode"aria-label="  Recipient's username" aria-describedby="basic-addon2">
          <div class="input-group-append">
            <button class="btn btn-outline-secondary" type="submit" value="<%=item._id%>" name="button">Upadate Pincode"</button>
          </div>
        </div>
      </form>

      <h6>Update Image</h6>
      <form action="/orphanagedetailsupdatepinimage" method="POST" enctype="multipart/form-data">
      <input class="file" type="file" name="image">
      <button type="submit" class="btn btn-primary" name="button" value="<%=item._id%>">Update Image</button>
      </form>
    </div>
  </div>
  <%}%>
  <%})%>
  <!-- /////////////////////////////////////////////////////////////////////////// -->
  <hr class="titlebelow" style="height:1px;border-width:0;color:#897134;background-color:#897134;">
  <div class="top">
    <div class="row">
      <div class="col-md-6 orphanageimagebox ">
        <%items.forEach(function(item){ %>
        <%if(check===item.adminname){%>
        <img class="orphanageimage" src="data:image/<%=item.img.contentType%>;base64,
                                       <%=item.img.data.toString('base64')%>">
        <%}%>
      <%})%>
      </div>
      <div class="col-md-6 box">
        <button class="button" onclick="openForm2()">Update <span class="iconify" data-icon="jam:write" style="font-size: 20px;"></span></button>
        <%items.forEach(function(item){ %>
        <%if(check===item.adminname){%>
        <p>Orphanage address : <%=item.address%></p>
        <p>Phone number : <%=item.phonenum%></p>
        <p>State : <%=item.state%></p>
        <p>City : <%=item.city%></p>
        <p>Pincode : <%=item.pincode%></p>
        <p>Mail : <%=item.mail%></p>
        <%}%>
        <%})%>
      </div>
    </div>
  </div>

  <!-- ////////////////////////////////description/////////////////////////// -->
  <h3 class="Childrenhed animate__animated animate__zoomInDown">Description</h3>
  <div class="descriptionbox">
    <%items.forEach(function(item){ %>
    <%if(check===item.adminname){%>
    <p><%=item.description%></p>
    <%}%>
    <%})%>
  </div>



  <!-- //////////////////////////////////request//////////////////////////////// -->

  <div class="requests">
    <h3>requests</h3>
    <%items.forEach(function(mainitem){ %>
    <%requestsgot.forEach(function(request){ %>
    <%if(check===mainitem.adminname){%>
    <%if(request.orphanagename===mainitem.name){%>
    <div class="containerrev">
      <div class="container  d-flex align-items-center justify-content-center position-relative flex-wrap">
        <div class="card d-flex position-relative flex-column">
          <div class='imgContainer'>
            <h6><%=request.requestername%></h6>
            <p>requested for <%=request.childname%></p>
          </div>
          <div class="content">
            <form class="" action="/acceptorreject" method="post">
              <button type="submit" class="btn btn-success" name="button" value="<%=request._id%>@<%=request.orphanagename%>&<%=request.requestername%>+<%=request.childname%>*ok"><i class="fas fa-user-check"></i></button>
              <button type="submit" class="btn btn-danger" name="button" value="<%=request._id%>@<%=request.orphanagename%>&<%=request.requestername%>+<%=request.childname%>*notok"><i class="fas fa-times"></i></button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <%}%>
    <%}%>
    <%})%>
    <%})%>
  </div>


  <!-- ////////////////////////////////children/////////////////////////// -->
  <h1 class="Childrenhed animate__animated animate__zoomInDown">Children</h1>
  <hr>
  <div class="container reveal scroll fade-left" style="width:90%px; height:90%px; border:0px; overflow-x:visible; overflow-y:hidden; white-space:nowrap;">
    <!-- various of text here that can makes it go out the border-->
    <%childitems.forEach(function(item){ %>
    <%items.forEach(function(mainitem){ %>
    <%if(check===mainitem.adminname){%>
    <%if(mainitem.name===item.orphanage){%>
    <!-- flip-card-container -->
    <div class="flip-card-container" style="--hue: 170">
      <div class="flip-card">
        <div class="card-front">
          <figure>
            <div class="img-bg"></div>
            <img src="images/cardbg.jpg" alt="Image 2">
            <figcaption><%=item.name%></figcaption>
          </figure>

          <ul>
            <p>Age : <%=item.age%></p>
            <p>Gender : <%=item.gender%></p>
            <p>Hobies : <%=item.hobies%></p>
            <p>Studies : <%=item.studies%></p>
            <p>Guardian : <%=item.guardian%></p>
            <p>Intrested In : <%=item.intrestedin%></p>
          </ul>
        </div>

        <div class="card-back">
          <figure>
            <div class="img-bg"></div>
            <img class="childimage" src="data:image/<%=item.img.contentType%>;base64,
                                                   <%=item.img.data.toString('base64')%>">
          </figure>

          <div class="design-container">
            <span class="design design--1"></span>
            <span class="design design--2"></span>
            <span class="design design--3"></span>
            <span class="design design--4"></span>
            <span class="design design--5"></span>
            <span class="design design--6"></span>
            <span class="design design--7"></span>
            <span class="design design--8"></span>
          </div>
        </div>
      </div>
    </div>
    <%}%>
            <%}%>
    <%}) %>
    <%})%>
  </div>





  <!-- ///////////////////////////////student add details/////////////////////////////////// -->
  <div class="btn11 botton" type="button" data-toggle="collapse" data-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
    <span>Add student details</span>
    <div class="transition"></div>
  </div>

  <div class="collapse" id="collapseExample">
    <div class="">
      <%items.forEach(function(item){ %>
      <%if(check===item.adminname){%>
      <div class="card adddetailsbox">
        <h1>Add Student Details</h1>
        <form action="/studentdetails" method="POST" enctype="multipart/form-data">
          <div class="form-row">
            <div class="form-group col-md-6">
              <label> Name</label>
              <input type="text" class="form-control" name="name" placeholder="Name" required>
            </div>
            <div class="form-group col-md-6">
              <label for="inputPassword4">Age</label>
              <input type="text" class="form-control" name="age" placeholder="Age">
            </div>
          </div>
          <div class="form-row">
            <div class="form-group col-md-6">
              <label> Gender</label>
              <input type="text" class="form-control" name="gender" placeholder="Gender" required>
            </div>
            <div class="form-group col-md-6">
              <label for="inputPassword4">Hobies</label>
              <input type="text" class="form-control" name="hobies" placeholder="Hobies">
            </div>
          </div>
          <div class="form-row">
            <div class="form-group col-md-6">
              <label> Intrested In</label>
              <input type="text" class="form-control" name="intrestedin" placeholder="Intrested In">
            </div>
            <div class="form-group col-md-6">
              <label for="inputPassword4">studies</label>
              <input type="text" class="form-control" name="studies" placeholder="studies">
            </div>
          </div>
          <div class="form-group col-md-6">
            <label for="inputPassword4">guardian</label>
            <input type="text" class="form-control" name="guardian" placeholder="guardian" required>
          </div>
          <div class="form-group col-md-6">
            <label for="inputPassword4">Date of Birth</label>
            <input type="date" class="form-control" name="dob" placeholder="DOB" required>
          </div>
          <input type="file" name="image" class="file" required>
          <button type="submit" class="btnfos btnfos-1" value="<%=item.name%>" name="button"> <svg>
              <rect x="0" y="0" fill="none" width="100%" height="100%" />
            </svg>Submit</button>
        </form>
      </div>
      <%}%>
        <%}) %>
    </div>
  </div>



  <%- include("footer") -%>
